<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   GreenQuest • Select Your Role
  </title>
  <!-- Brand Typography -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <!-- Font Awesome 6 -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
  <!-- Global Theme Styles -->
  <link href="style.css" rel="stylesheet"/>
  <link rel="stylesheet" href="responsive.css">

  <!-- Page-specific CSS -->
  <link href="role_selection.css" rel="stylesheet"/>
 </head>
 <body class="d-flex flex-column min-vh-100 bg-surface">
  <!-- Header (Common Component) -->
  <header class="navbar navbar-expand bg-white border-bottom sticky-top">
   <style>
    :root { --gq-primary:#008000; --gq-secondary:#00FFFF; }
      .nav-brand-title{color:var(--gq-primary); font-weight:600;}
      .gq-action:hover{background:rgba(0,128,0,0.08);}
   </style>
   <div class="container-fluid">
    <button class="btn d-md-none me-2" data-bs-target="#offcanvasOnboarding" data-bs-toggle="offcanvas" type="button">
     <i class="fas fa-bars">
     </i>
    </button>
    <div class="navbar-brand d-flex align-items-center">
     <i class="fas fa-leaf me-2" style="color:var(--gq-primary)">
     </i>
     <span class="nav-brand-title">
      GreenQuest
     </span>
    </div>
    <ul class="navbar-nav ms-auto align-items-center">
     <li class="nav-item me-2">
      <a class="btn btn-outline-success gq-action" href="#help">
       <i class="fas fa-question-circle me-1">
       </i>
       Help
      </a>
     </li>
     <li class="nav-item">
      <a class="btn btn-success" href="./login_page.html">
       <i class="fab fa-google me-2">
       </i>
       Sign in with Google
      </a>
     </li>
    </ul>
   </div>
   <div class="offcanvas offcanvas-start" id="offcanvasOnboarding" tabindex="-1">
    <div class="offcanvas-header">
     <h5 class="offcanvas-title">
      <i class="fas fa-leaf me-2" style="color:#008000">
      </i>
      GreenQuest
     </h5>
     <button class="btn-close" data-bs-dismiss="offcanvas" type="button">
     </button>
    </div>
    <div class="offcanvas-body">
     <p class="text-muted">
      Welcome to GreenQuest. Please sign in to continue.
     </p>
     <a class="btn btn-success w-100 mb-2" href="./login_page.html">
      <i class="fab fa-google me-2">
      </i>
      Sign in with Google
     </a>
     <a class="btn btn-outline-success w-100" href="#help">
      <i class="fas fa-question-circle me-2">
      </i>
      Help
     </a>
    </div>
   </div>
  </header>
  <!-- Main Content -->
  <main class="flex-grow-1" id="main-content">
   <!-- Breadcrumb -->
   <nav aria-label="breadcrumb" class="container breadcrumb">
    <ol class="breadcrumb m-0">
     <li class="breadcrumb-item">
      <a href="./login_page.html">
       Login
      </a>
     </li>
     <li class="breadcrumb-item">
      <a href="./role_selection.html">
       Onboarding
      </a>
     </li>
     <li aria-current="page" class="breadcrumb-item active">
      Select Role
     </li>
    </ol>
   </nav>
   <!-- System feedback area -->
   <div aria-atomic="true" aria-live="polite" class="container mt-3">
    <div class="alert alert-info d-flex align-items-center mb-3" id="systemAlert" role="alert">
     <i class="fa-solid fa-circle-info me-2">
     </i>
     <div>
      You're signed in. Choose your primary role to continue.
     </div>
    </div>
   </div>
   <!-- Role Selector -->
   <section class="container container-max py-3 py-md-4">
    <div class="row justify-content-center">
     <div class="col-lg-10 col-xl-8">
      <div class="app-card p-0 overflow-hidden">
       <div class="card-header">
        <div class="d-flex align-items-center gap-2">
         <span class="widget-title" id="welcomeTitle">
          Welcome,
          <span id="userFirstName">
           Explorer
          </span>
          !
         </span>
        </div>
        <div class="text-muted small" id="signedInAs">
         How will you be using GreenQuest?
        </div>
       </div>
       <div class="card-body">
        <div class="role-grid row g-3 g-lg-4 align-items-stretch">
         <!-- Student Role Card -->
         <div class="col-md-6">
          <div aria-label="Select Student role" aria-pressed="false" class="card role-card h-100" data-role="student" role="button" tabindex="0">
           <div class="card-body d-flex align-items-start gap-3">
            <div class="role-media text-center">
             <div class="role-icon bg-success-subtle text-success">
              <i class="fa-solid fa-graduation-cap">
              </i>
             </div>
             <img alt="Student illustration" class="role-illustration d-none d-sm-block mt-2 rounded" onerror="this.onerror=null;this.src='https://picsum.photos/seed/student-fallback/120/120';" src="https://picsum.photos/seed/student/120/120"/>
            </div>
            <div class="flex-grow-1">
             <h5 class="mb-1">
              I am a Student
             </h5>
             <p class="mb-2 text-muted">
              Join your class, complete fun challenges, and earn points!
             </p>
             <ul class="list-unstyled small text-muted mb-0">
              <li>
               <i class="fa-regular fa-circle-check me-1 text-success">
               </i>
               Join classes via code
              </li>
              <li>
               <i class="fa-regular fa-circle-check me-1 text-success">
               </i>
               Submit proof and earn badges
              </li>
              <li>
               <i class="fa-regular fa-circle-check me-1 text-success">
               </i>
               Track progress on your dashboard
              </li>
             </ul>
            </div>
           </div>
          </div>
         </div>
         <!-- Teacher Role Card -->
         <div class="col-md-6">
          <div aria-label="Select Teacher role" aria-pressed="false" class="card role-card h-100" data-role="teacher" role="button" tabindex="0">
           <div class="card-body d-flex align-items-start gap-3">
            <div class="role-media text-center">
             <div class="role-icon bg-info-subtle text-info">
              <i class="fa-solid fa-chalkboard-user">
              </i>
             </div>
             <img alt="Teacher illustration" class="role-illustration d-none d-sm-block mt-2 rounded" onerror="this.onerror=null;this.src='https://picsum.photos/seed/teacher-fallback/120/120';" src="https://picsum.photos/seed/teacher/120/120"/>
            </div>
            <div class="flex-grow-1">
             <h5 class="mb-1">
              I am a Teacher
             </h5>
             <p class="mb-2 text-muted">
              Create classes, verify submissions, and track student progress.
             </p>
             <ul class="list-unstyled small text-muted mb-0">
              <li>
               <i class="fa-regular fa-circle-check me-1 text-success">
               </i>
               Create and manage classes
              </li>
              <li>
               <i class="fa-regular fa-circle-check me-1 text-success">
               </i>
               Approve student submissions
              </li>
              <li>
               <i class="fa-regular fa-circle-check me-1 text-success">
               </i>
               Monitor impact and analytics
              </li>
             </ul>
            </div>
           </div>
          </div>
         </div>
        </div>
        <!-- Confirmation Area -->
        <div class="d-flex flex-column flex-md-row align-items-start align-items-md-center justify-content-between mt-4 gap-3">
         <div class="text-muted small">
          By continuing, you agree to our
          <a href="#terms">
           Terms
          </a>
          and
          <a href="#privacy">
           Privacy Policy
          </a>
          .
         </div>
         <div class="d-flex align-items-center gap-2">
          <a class="btn btn-light" href="./login_page.html">
           <i class="fa-solid fa-arrow-left me-1">
           </i>
           Not you? Switch account
          </a>
          <button class="btn btn-success btn-lg" disabled="" id="confirmBtn" type="button">
           <span class="btn-label">
            Continue
           </span>
           <span aria-hidden="true" class="spinner-border spinner-border-sm ms-2 d-none" role="status">
           </span>
          </button>
         </div>
        </div>
       </div>
      </div>
      <!-- Quick Links for testing navigation (optional) -->
      <div class="text-center mt-3 small text-muted">
       Need to come back later? You can access this page anytime at
       <code>
        ./role_selection.html
       </code>
       .
      </div>
     </div>
    </div>
   </section>
  </main>
  <!-- Footer (Common Component) -->
  <footer class="border-top bg-white mt-auto">
   <div class="container py-3 d-flex flex-wrap justify-content-between align-items-center">
    <div class="d-flex align-items-center text-muted">
     <i class="fas fa-leaf me-2" style="color:#008000;">
     </i>
     <small>
      © GreenQuest
     </small>
    </div>
    <ul class="nav">
     <li class="nav-item">
      <a class="nav-link px-2 text-muted" href="#terms">
       Terms
      </a>
     </li>
     <li class="nav-item">
      <a class="nav-link px-2 text-muted" href="#privacy">
       Privacy
      </a>
     </li>
    </ul>
   </div>
  </footer>
  <!-- Toasts / Notifications -->
  <div class="position-fixed top-0 end-0 p-3" style="z-index: 1080">
   <div aria-atomic="true" aria-live="polite" class="toast align-items-center border bg-white" id="liveToast" role="status">
    <div class="d-flex">
     <div class="toast-body" id="toastBody">
      Action completed.
     </div>
     <button aria-label="Close" class="btn-close me-2 m-auto" data-bs-dismiss="toast" type="button">
     </button>
    </div>
   </div>
  </div>
  <!-- Bootstrap 5 JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js">
  </script>
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11">
  </script>
  <!-- Page Script -->
  <script>
   (function() {
    const roleCards = document.querySelectorAll('.role-card');
    const confirmBtn = document.getElementById('confirmBtn');
    const btnSpinner = confirmBtn.querySelector('.spinner-border');
    const btnLabel = confirmBtn.querySelector('.btn-label');
    let selectedRole = null;

    // Utility: Show toast
    function showToast(message) {
        const toastEl = document.getElementById('liveToast');
        document.getElementById('toastBody').textContent = message;
        const toast = bootstrap.Toast.getOrCreateInstance(toastEl, {
            delay: 2200
        });
        toast.show();
    }

    // Read user name/email from query string or localStorage
    const params = new URLSearchParams(window.location.search);
    const firstNameParam = params.get('name') || '';
    const emailParam = params.get('email') || '';
    const storedName = localStorage.getItem('gqUserFirstName') || '';
    const firstName = firstNameParam || storedName || 'Explorer';
    localStorage.setItem('gqUserFirstName', firstName);
    document.getElementById('userFirstName').textContent = firstName;
    const signedInAs = document.getElementById('signedInAs');
    if (emailParam) {
        signedInAs.innerHTML = 'Signed in as <strong>' + emailParam + '</strong>. How will you be using GreenQuest?';
    }

    function setSelectedRole(role) {
        selectedRole = role;
        roleCards.forEach(c => {
            const isActive = c.dataset.role === role;
            c.classList.toggle('selected', isActive);
            c.setAttribute('aria-pressed', isActive ? 'true' : 'false');
        });
        confirmBtn.disabled = !selectedRole;
        if (selectedRole) showToast('Selected: ' + (selectedRole === 'student' ? 'Student' : 'Teacher'));
    }

    roleCards.forEach(card => {
        card.addEventListener('click', () => setSelectedRole(card.dataset.role));
        card.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                setSelectedRole(card.dataset.role);
            }
            if (e.key === 'ArrowRight' || e.key === 'ArrowLeft') {
                const next = card.dataset.role === 'student' ? 'teacher' : 'student';
                setSelectedRole(next);
            }
        });
    });

    async function saveRole(role) {
        // Simulate API call to persist role; replace with real fetch in production
        return new Promise((resolve, reject) => {
            setTimeout(() => {
                // 92% success rate simulation
                Math.random() < 0.92 ? resolve({
                    ok: true
                }) : reject(new Error('Network error'));
            }, 1100);
        });
    }

    confirmBtn.addEventListener('click', async () => {
        if (!selectedRole) return;
        confirmBtn.disabled = true;
        btnSpinner.classList.remove('d-none');
        btnLabel.textContent = 'Saving...';

        Swal.fire({
            title: 'Saving your role',
            html: 'Please wait while we set things up for you.',
            allowOutsideClick: false,
            didOpen: () => {
                Swal.showLoading();
            }
        });

        try {
            const res = await saveRole(selectedRole);
            if (res && res.ok) {
                localStorage.setItem('gqRole', selectedRole);
                Swal.fire({
                    icon: 'success',
                    title: 'Role saved',
                    text: selectedRole === 'student' ? 'Welcome to your learning journey!' : 'Welcome, educator!',
                    timer: 1100,
                    showConfirmButton: false
                });
                setTimeout(() => {
                    if (selectedRole === 'student') {
                        window.location.href = './join_class.html';
                    } else {
                        window.location.href = './create_class.html';
                    }
                }, 1100);
            } else {
                throw new Error('Unexpected response');
            }
        } catch (err) {
            Swal.fire({
                icon: 'error',
                title: 'Could not save your role',
                text: 'Please check your connection and try again.'
            });
            confirmBtn.disabled = false;
        } finally {
            btnSpinner.classList.add('d-none');
            btnLabel.textContent = 'Continue';
        }
    });

    // If a role was previously selected, pre-select it
    const existingRole = localStorage.getItem('gqRole');
    if (existingRole === 'student' || existingRole === 'teacher') {
        setSelectedRole(existingRole);
    }
})();
  </script>
 </body>
</html>
